# Seguridad con claves SSH y mas seguridad

## Instrucciones

1) En el archivo /etc/ssh/sshd_config (En el PC Servidor)

Port 2222
PermitRootLogin no
PasswordAuthentication yes (DESPUES CAMBIAMOS A NO)
ChallengeResponseAuthentication no
PubkeyAuthentication yes
AllowUsers (NOMBRE DE USUSARIOS QUE QUIERES QUE ENTREN)

Despues:

sudo systemctl restart sshd

2) Crear claves SSH en el ordenador Cliente. el ordenador donde quieres acceder al servidor

ssh-keygen -t ed25519 (Esto solo hace falta una vez si queires hacer en mas ordenadores)

ssh-copy-id -p 2222 usuario@IP_DEL_SERVIDOR (Puedes crear clave para mas seguirdad, passphrase)

3) despues editamos otra vez el archivo sshd_conifg

cmabiamos el PasswordAuthentication yes a no

sudo systemctl restart sshd

4) Instalamos fail2ban

sudo dnf install fail2ban -y 
sudo systemctl enable --now fail2ban

LISTO

--------------

Extras:

* Abrir SSH a internet: Usar Tailscale. Esta aplicacion crea una VPN y no necesitas abrir puertos en el router para conectarte via SSH

* Como hacer un alias para no tener que escribir USUARIO@IP -p 2222, usarias solo NOMBRE

ej: en vez de usar:
ssh -p 2222 usuario@192.168.1.45 
usarias:
ssh NOMBRE

* Copiar archivos:
No hay que conectarse por ssh. lo tienes que hacer desde tu terminal.
ej:
scp -P 2222 usuario@192.168.1.45:/home/usuario/documento.pdf ~/Downloads/
ahora:
scp fedora:documento.pdf ~/Downloads/

- Como crear el Alias en tu ordnador cliente:

editar o crear este archivo:

~/.ssh/conifg

Host ALIAS
    HostName IP
    User tu_usuario_de_fedora
    Port 2222
    IdentityFile ~/.ssh/id_rsa (Por defecto) -> mirar en carpeta ~/.ssh/ un archivo .pub. Ese es el nombre a poner

* Si no quieres meter la contraseña passphrase de las llaves SSH cada vez, puedes incluir esto en Host ALIAS:
SOLO PARA MAC   
    UseKeychain yes
    
Este meterlo en mac y linux, da igual
AddKeysToAgent yes (Esto hace que si meto una vezx la contraseña no tenga que meterla mas)

en fedora:
sudo dnf install openssh-askpass

luego cuando entres en el escritorio te pide una vez la contraseña y ya esta


Para LINUX:

permisos: 
chmod 700 ~/.ssh
chmod 600 config
sudo chown -R TUUSUARIO ~/.ssh




